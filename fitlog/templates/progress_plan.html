{% extends "base.html" %}
{% block title %}Trainingsfortschritt{{ title_suffix or "" }}{% endblock %}

{% block content %}
<div class="progress-page card"
     id="progressPage"
     data-home-url="{{ url_for('index') }}"
     data-overview-url="{{ url_for('progress.overview') }}"
     data-plan-png-template="{{ url_for('progress.plan_png', plan_id=0) }}"
     data-exercise-png-template="{{ url_for('progress.exercise_png', exercise_id=0) }}">


  <!-- Kopfbereich: App-Titel, Diagramm-Auswahl, Schließen -->
  <header class="progress-header">
    <div class="progress-header__left">
      <div class="progress-app-title">
        FitLog – Der Trainingsplantracker
      </div>

      <div class="progress-row">
        <label for="diagramType">Diagramm</label>
        <select id="diagramType" class="progress-select">
          <option value="plan"
                  {% if diagram_type == "plan" %}selected{% endif %}>
            Aktueller Leistungsstand pro Trainingsplan
          </option>
          <option value="exercise"
                  {% if diagram_type == "exercise" %}selected{% endif %}>
            Leistung über Zeit
          </option>
        </select>
      </div>

      <div class="progress-plan-title">
        {% if diagram_type == "plan" %}
          Trainingsfortschritt{% if selected_plan_name %} – {{ selected_plan_name }}{% endif %}
        {% else %}
          Übungsverlauf{% if selected_exercise_name %} – {{ selected_exercise_name }}{% endif %}
        {% endif %}
      </div>
    </div>

    <button type="button" class="btn btn--outline progress-close" id="btnClose">
      X
    </button>
  </header>

  <!-- Steuerbereich: Auswahl + Aktionen -->
  <section class="progress-controls">
    <!-- Auswahl Trainingsplan -->
    <div
      class="progress-control-group{% if diagram_type != 'plan' %} is-hidden{% endif %}"
      id="planGroup"
    >
      <label for="planSelect">Trainingsplan:</label>
      <select id="planSelect" class="progress-select">
        <option value="">Auswählen</option>
        {% for p in plans %}
          <option value="{{ p.id }}"
                  {% if selected_plan_id and selected_plan_id == p.id %}selected{% endif %}>
            {{ p.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Auswahl Übung -->
    <div
      class="progress-control-group{% if diagram_type != 'exercise' %} is-hidden{% endif %}"
      id="exerciseGroup"
    >
      <label for="exerciseSelect">Übung:</label>
      <select id="exerciseSelect" class="progress-select">
        <option value="">Auswählen</option>
        {% for ex in exercises %}
          <option value="{{ ex.id }}"
                  {% if selected_exercise_id and selected_exercise_id == ex.id %}selected{% endif %}>
            {{ ex.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="progress-controls__actions">
      <button type="button"
              class="btn"
              id="btnExport"
              {% if not image_url %}disabled aria-disabled="true"{% endif %}>
        Export (PNG)
      </button>
    </div>
  </section>

  <!-- Diagramm-Bereich -->
  <section class="progress-chart">
    {% if image_url %}
      <img
        src="{{ image_url }}"
        alt="Trainingsfortschritt Diagramm"
        class="progress-chart__img"
      >
    {% else %}
      <!-- Keine Auswahl: leere Fläche wie im Mockup -->
    {% endif %}
  </section>

  <!-- Fußbereich: Zurück-Button -->
  <footer class="progress-footer">
    <button type="button" class="btn" id="btnBack">
      Zurück
    </button>
  </footer>
</div>

{% endblock %}
{% block extra_js %}
  <script src="{{ url_for('static', filename='js/progress.js') }}" defer></script>
{% endblock %}
