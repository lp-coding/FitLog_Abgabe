{% extends "base.html" %}
{% block title %}Plan bearbeiten – {{ plan.name }}{% endblock %}

{% block content %}
<div class="plan-edit">

  <div class="plan-header">
    <input class="plan-name-input" type="text" name="plan_name" value="{{ plan.name }}" form="edit-form" placeholder="Planname">
    <a class="icon-btn close-btn" href="{{ url_for('index') }}" title="Ohne Speichern schließen" aria-label="Schließen">×</a>
  </div>

  <form id="edit-form" action="{{ url_for('plans.update_plan', plan_id=plan.id) }}" method="post">
    <table id="dndTable"
           class="table-edit"
           data-remove-url="{{ url_for('plans.remove_exercise', plan_id=plan.id) }}">
      <thead>
        <tr>
          <th class="col-drag"></th>
          <th>Übung</th>
          <th class="col-sets">Sätze</th>
          <th class="col-reps">Wdh.</th>
          <th class="col-weight">Gewicht (kg)</th>
          <th>Notiz</th>
          <th class="col-actions"></th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
        <tr class="dnd-row" draggable="true" data-ex-id="{{ it.exercise_id }}">
          <td class="drag" title="Ziehen, um Reihenfolge zu ändern">≡</td>
          <td class="cell-name">
            {{ it.name }}
            <input type="hidden" name="exercise_id[]" value="{{ it.exercise_id }}">
            <input type="hidden" name="position[]" value="{{ loop.index }}">
          </td>
          <td><input class="input-num" type="number" name="default_sets[]" value="{{ it.default_sets or 3 }}" min="1"></td>
          <td><input class="input-num" type="number" name="default_reps[]" value="{{ it.default_reps or 10 }}" min="1"></td>
          <td><input class="input-num" type="number" step="0.5" name="default_weight_kg[]" value="{{ it.default_weight_kg or 0 }}"></td>
          <td><input class="input-note" type="text" name="note[]" value="{{ it.note or '' }}" placeholder="…"></td>
          <td>
            <button class="icon-btn" type="button" data-remove="{{ it.exercise_id }}" title="Aus Plan entfernen">✕</button>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="7" class="muted">Noch keine Übungen im Plan.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </form>

  <div class="footer-bar">
    <form class="add-exercise-form" action="{{ url_for('plans.add_exercise', plan_id=plan.id) }}" method="post">
      <label for="exercise-select" class="sr-only">Übung auswählen</label>
      <select id="exercise-select" name="exercise_id" class="input-select">
        {% for e in all_exercises %}
          <option value="{{ e.id }}">{{ e.name }}</option>
        {% endfor %}
      </select>
      <button class="btn" type="submit">Übung hinzufügen</button>
    </form>

    <div class="actions">
      <a class="btn btn-secondary" href="{{ url_for('index') }}">Abbrechen</a>
      <button class="btn btn-primary" type="submit" form="edit-form">Speichern</button>
    </div>
  </div>
</div>

{% endblock %}
{% block extra_js %}
  <script src="{{ url_for('static', filename='js/edit.js') }}" defer></script>
{% endblock %}
